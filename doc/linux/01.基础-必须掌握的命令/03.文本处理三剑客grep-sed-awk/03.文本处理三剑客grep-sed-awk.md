



# 文本处理三剑客grep/sed/awk/命令详解



这三个是Linux/Unix系统中最强大的文本处理工具，被称为"文本处理三剑客"。必须熟练掌握，这是处理日志和数据的核心工具

## 1. grep - 文本搜索工具

### 基本功能

用于在文件中搜索匹配特定模式的行。

### 常用语法

bash

```
grep [选项] 模式 [文件...]
```



### 主要选项

- `-i`：忽略大小写
- `-v`：反向选择，显示不匹配的行
- `-n`：显示行号
- `-r`或`-R`：递归搜索目录
- `-l`：只显示包含匹配的文件名
- `-c`：统计匹配的行数
- `-E`：使用扩展正则表达式（等同于egrep）
- `-A n`：显示匹配行及其后n行
- `-B n`：显示匹配行及其前n行
- `-C n`：显示匹配行及其前后各n行

### 示例

bash

```
# 基本搜索
grep "error" logfile.txt

# 忽略大小写搜索
grep -i "error" logfile.txt

# 显示行号
grep -n "error" logfile.txt

# 递归搜索目录
grep -r "function" /path/to/code/

# 使用正则表达式
grep "^[0-9]" file.txt  # 以数字开头的行
grep "[A-Za-z]$" file.txt  # 以字母结尾的行
```



## 2. sed - 流编辑器

### 基本功能

用于对文本进行流式编辑（查找替换、删除、插入等）。

### 常用语法

bash

```
sed [选项] '命令' [文件...]
```



### 主要命令

- `s`：替换
- `d`：删除
- `p`：打印
- `a`：在行后追加
- `i`：在行前插入
- `c`：替换整行

### 示例

bash

```
# 基本替换（只替换每行第一个匹配）
sed 's/old/new/' file.txt

# 全局替换
sed 's/old/new/g' file.txt

# 替换特定行
sed '5s/old/new/' file.txt  # 只替换第5行
sed '1,5s/old/new/' file.txt  # 替换1-5行

# 删除行
sed '5d' file.txt  # 删除第5行
sed '1,5d' file.txt  # 删除1-5行
sed '/pattern/d' file.txt  # 删除匹配模式的行

# 原地编辑（直接修改文件）
sed -i 's/old/new/g' file.txt

# 多重操作
sed -e 's/old/new/g' -e '5d' file.txt

# 打印特定行
sed -n '5p' file.txt  # 只打印第5行
```



## 3. awk - 模式扫描和处理语言

### 基本功能

强大的文本分析工具，可以处理结构化文本数据。

### 常用语法

bash

```
awk [选项] '模式 {动作}' [文件...]
```



### 内置变量

- `NR`：当前记录数（行号）
- `NF`：当前记录的字段数
- `FS`：字段分隔符（默认空格）
- `OFS`：输出字段分隔符
- `RS`：记录分隔符
- `ORS`：输出记录分隔符
- `$0`：整行内容
- `$1, $2, ...`：第1, 2, ...个字段

### 示例

bash

```
# 打印特定字段
awk '{print $1, $3}' file.txt  # 打印每行的第1和第3个字段

# 指定分隔符
awk -F: '{print $1, $6}' /etc/passwd  # 以冒号分隔

# 条件过滤
awk '$3 > 1000 {print $1}' /etc/passwd  # 第三字段大于1000的行
awk '/error/ {print $0}' logfile.txt  # 包含error的行

# 使用内置变量
awk '{print NR, NF, $0}' file.txt  # 打印行号、字段数和整行

# 计算和统计
awk '{sum += $1} END {print sum}' numbers.txt  # 求和
awk '{count++} END {print count}' file.txt  # 统计行数

# 复杂处理
awk 'BEGIN {FS=":"; OFS="\t"} $3 >= 1000 {print $1, $3, $6}' /etc/passwd
```



## 4. 三剑客组合使用示例

### 复杂文本处理

bash

```
# 查找包含"error"的行，提取时间戳和错误信息
grep "error" logfile.txt | awk '{print $1, $2, $NF}'

# 替换配置文件中的值并注释原行
sed -i.bak 's/^ServerName/# &/; /^# ServerName/a\ServerName new.example.com' httpd.conf

# 统计不同IP的访问次数
awk '{print $1}' access.log | sort | uniq -c | sort -nr

# 提取特定进程的内存使用
ps aux | grep "nginx" | awk '{sum += $4} END {print sum "%"}'
```



## 5. 实用技巧

### grep 技巧

bash

```
# 搜索多个模式
grep -e "error" -e "warning" logfile.txt
grep -E "error|warning" logfile.txt  # 使用扩展正则

# 排除多个模式
grep -v -e "debug" -e "test" logfile.txt
```



### sed 技巧

bash

```
# 只在匹配特定模式的行中替换
sed '/pattern/s/old/new/g' file.txt

# 使用不同的分隔符（处理路径时有用）
sed 's|/old/path|/new/path|g' file.txt
```



### awk 高级用法

bash

```
# 数组处理
awk '{count[$1]++} END {for (ip in count) print ip, count[ip]}' access.log

# 条件判断
awk '{if ($3 > 1000) print "User:", $1; else print "System:", $1}' /etc/passwd

# 字符串函数
awk '{print toupper($1), length($0)}' file.txt
```

这三个工具各有侧重：grep擅长搜索，sed擅长编辑，awk擅长分析和处理结构化数据。掌握它们可以极大地提高在Linux环境下的文本处理效率。