



**文件系统与权限：** 理解根目录结构（FHS），精通用户、组、文件权限（rwx, suid, sgid, sticky bit）和ACL。





## 第一节：文件系统与目录

我们来系统地讲解一下 Linux 系统的文件系统和目录结构。这对于理解和使用 Linux 至关重要。

### 一、核心思想：一切皆文件

这是 Linux 和 Unix 哲学的基础。在 Linux 中，几乎所有资源都被抽象为“文件”或“文件目录”的形式进行管理和访问。这包括：

- **普通文件**：文本、程序、图片、数据等。
- **目录**：即文件夹，用于组织文件和其他目录。
- **硬件设备**：如硬盘、键盘、打印机、USB设备，在 `/dev` 目录下以文件形式存在。
- **进程信息、系统状态**：在 `/proc` 和 `/sys` 目录下以虚拟文件形式存在。
- **套接字和管道**：用于进程间通信。

这种统一的接口使得管理和操作各种资源变得非常简单和一致。

------

### 二、文件系统层次标准

Linux 的目录结构遵循一个名为 **FHS** 的标准。这个标准规定了哪个目录应该存放什么类型的文件，这保证了不同 Linux 发行版（如 Ubuntu, CentOS, Debian）之间目录结构的一致性，降低了用户的学习成本。

FHS 将目录定义为四种交互作用：

1. **可共享 vs 不可共享**：是否可以被不同主机共享（如 `/home` 用户目录可以网络共享，而 `/etc` 配置目录则特定于本机）。
2. **静态 vs 动态**：是否可以被随意修改（如 `/usr` 下的程序是静态的，而 `/var` 下的日志是动态变化的）。

------

### 三、核心目录详解

下面我们逐一解析 Linux 根目录（`/`）下的主要目录及其用途。你可以把 `/` 想象成 Windows 的 `C:\`。

| 目录路径                 | 英文全称/含义             | 核心用途说明                                                 | 类比 Windows                                      |
| :----------------------- | :------------------------ | :----------------------------------------------------------- | :------------------------------------------------ |
| **`/`**                  | **Root**                  | **根目录**，是整个文件系统的起点，所有其他目录和文件都在它之下。 | `C:\`                                             |
| **`/bin`**               | **Binary**                | **基础系统命令**。存放所有用户（包括管理员和普通用户）都需要使用的、最基础的必要命令，如 `ls`, `cp`, `cat`, `bash` 等。系统启动或修复时也需要它们。 | `C:\Windows\System32` 的一部分                    |
| **`/boot`**              | **Boot**                  | **系统启动文件**。包含 **内核文件**、**引导加载程序** 的文件（如 GRUB）。**不要随意删除此目录，否则系统将无法启动。** | 启动分区                                          |
| **`/dev`**               | **Devices**               | **设备文件**。存放代表硬件设备的特殊文件，如 `/dev/sda` 代表第一块硬盘，`/dev/tty` 代表终端。 | 设备管理器                                        |
| **`/etc`**               | **Etc.**                  | **系统配置文件**。存放几乎所有系统和应用程序的**配置文件**。例如，用户账户密码文件、网络配置、软件源列表等。**这是系统管理员最常打交道的目录之一。** | `C:\Windows\System32\drivers\etc\` 和注册表的结合 |
| **`/home`**              | **Home**                  | **用户主目录**。每个普通用户都会在此目录下有一个以自己的用户名命名的子目录（如 `/home/alice`），用于存放个人文件、配置文件、桌面、下载等。**这是用户个人的“地盘”。** | `C:\Users\`                                       |
| **`/lib`**, **`/lib64`** | **Libraries**             | **系统库文件**。存放 `/bin` 和 `/sbin` 目录下二进制程序所依赖的**共享库文件**（类似于 Windows 的 `.dll` 文件）。 | `C:\Windows\System32` 里的 `.dll` 文件            |
| **`/media`**             | **Media**                 | **可移动媒体挂载点**。系统会自动将可移动设备（如 U 盘、光盘、SD 卡）挂载到此目录下的子目录中。 | 可移动驱动器的自动挂载                            |
| **`/mnt`**               | **Mount**                 | **临时挂载点**。系统管理员**手动临时挂载**文件系统（如网络驱动器、额外的硬盘分区）的目录。 | 手动分配的驱动器盘符                              |
| **`/opt`**               | **Optional**              | **可选的应用软件包**。通常存放一些**第三方商业软件**或大型应用程序，它们的所有文件都集中在自己的子目录下。 | `C:\Program Files` 的一部分                       |
| **`/proc`**              | **Process**               | **进程与内核信息**。这是一个**虚拟文件系统**，它不占用磁盘空间，里面的文件是内存的映射，实时反映了系统内核和进程的运行状态。 | 任务管理器中的详细信息                            |
| **`/root`**              | **Root**                  | **系统管理员（root）的主目录**。注意这不是根目录 `/`，而是超级用户 root 的家目录，普通用户无权访问。 | `C:\Users\Administrator`                          |
| **`/run`**               | **Run**                   | **运行时数据**。存放自系统启动以来描述系统信息的文件，如当前登录的用户、运行的守护进程的 PID 文件等。这是一个临时文件系统，重启后清除。 | 临时运行时数据                                    |
| **`/sbin`**              | **System Binary**         | **系统管理命令**。存放用于**系统管理**和**修复**的命令，通常只有 root 用户才有权限执行，如 `fdisk`, `ifconfig`, `reboot`。 | `C:\Windows\System32` 中管理员权限的命令          |
| **`/srv`**               | **Service**               | **服务数据**。存放由本系统提供的**服务**所产生的数据。例如，Web 服务器的网站文件可以放在 `/srv/www`，FTP 的文件可以放在 `/srv/ftp`。 | `C:\inetpub\wwwroot`                              |
| **`/sys`**               | **System**                | **系统设备信息**。另一个虚拟文件系统，与 `/proc` 类似，但提供了一个更统一的结构来访问**硬件设备**的配置和信息。 | 设备管理器的详细信息                              |
| **`/tmp`**               | **Temporary**             | **临时文件**。供所有用户存放临时文件。系统可能定期清理此目录。 | `C:\Users\<Username>\AppData\Local\Temp`          |
| **`/usr`**               | **Unix System Resources** | **Unix 系统资源**。这是**非常大且重要**的目录，存放**只读**的用户数据和应用程序，类似于 Windows 的 `C:\Program Files` 和 `C:\Windows` 的结合体。 |                                                   |
| ` /usr/bin`              |                           | **绝大多数用户命令**。系统安装的大部分应用程序的可执行文件都在这里。 | `C:\Program Files` 下的 `.exe`                    |
| ` /usr/lib`              |                           | **应用程序的库文件**。`/usr/bin` 和 `/usr/sbin` 中程序的库文件。 | `C:\Program Files` 下的 `.dll`                    |
| ` /usr/local`            |                           | **本地安装的软件**。系统管理员**手动编译安装**的软件通常放在这里，以避免被系统升级影响。 | 自定义安装的软件                                  |
| ` /usr/sbin`             |                           | **非必要的系统管理命令**。                                   | 非核心的管理员命令                                |
| ` /usr/share`            |                           | **架构无关的共享数据**。如文档、图标、字体、时区数据等。     | `C:\Windows` 下的共享资源                         |
| **`/var`**               | **Variable**              | **可变数据**。存放经常变化的文件，如**日志文件**、**缓存**、**数据库文件**、**邮件**等。 | `C:\Windows\Logs`, `C:\Windows\Temp` 等           |

------

### 四、重要概念：挂载

这是理解 Linux 文件系统的关键。在 Windows 中，每个分区都有一个独立的盘符（如 C:, D:）。而在 Linux 中，**没有盘符的概念**。

Linux 文件系统只有一个根 `/`。额外的硬盘分区、U 盘、光盘等，都需要“挂载”到根文件系统的某个空目录（如 `/mnt` 或 `/media` 下的目录）上。这个目录就成为访问该存储设备的“入口”。挂载后，该目录下的内容就是新设备的内容。

**示例**：
当你插入一个 U 盘时，系统可能会自动将其挂载到 `/media/yourusername/USB_DISK`。此时，访问这个目录就相当于访问 U 盘。

### 总结

- **层次化、标准化**：Linux 目录结构清晰、有逻辑，遵循 FHS 标准。
- **一切皆文件**：统一的资源访问方式。
- **无盘符**：通过“挂载”将存储设备整合到单一的树形结构中。
- **职责分离**：不同目录有明确分工（如 `/etc` 配置，`/home` 用户数据，`/usr` 程序），这使得系统易于维护、备份和恢复。

掌握这些目录的用途，将极大地帮助你进行系统管理、故障排查和软件开发。



## 第二节：用户管理和权限

Linux 用户和权限管理是系统运维的核心基础。下面我将非常详细地为你讲解相关的命令、概念和实例。

------

### 一、用户管理

Linux 系统中，用户信息主要存储在 `/etc/passwd` 文件中，密码（加密后）存储在 `/etc/shadow` 文件中。

#### 1. `useradd` - 创建新用户

**功能：** 创建新的用户账户。

**常用语法：** `useradd [选项] 用户名`

**常用选项：**

- `-c "注释"`：为用户添加注释，通常是全名。
- `-d 家目录路径`：指定用户的家目录。
- `-m`：如果家目录不存在，则**创建**它。（**非常重要**，不加此选项不会自动创建家目录）
- `-s shell路径`：指定用户的登录 Shell（如 `/bin/bash` 或 `/sbin/nologin`）。
- `-g 主组名或GID`：指定用户的**主组**。
- `-G 附加组名或GID`：指定用户的**附加组**（多个组用逗号分隔）。
- `-u UID`：为用户指定一个特定的 UID。

**实例：**

bash

```
# 基本创建，但不创建家目录（不推荐）
sudo useradd john

# 正确方式：创建用户并同时创建家目录
sudo useradd -m -c "John Doe" -s /bin/bash john

# 创建系统用户（无登录Shell，通常用于运行服务）
sudo useradd -r -s /sbin/nologin mysql

# 创建用户并指定UID和主组
sudo useradd -m -u 1500 -g developers -G docker,www-data alice
```



#### 2. `passwd` - 设置或修改用户密码

**功能：** 为用户设置或修改密码。root 用户可以修改任何用户的密码，普通用户只能修改自己的密码。

**常用语法：** `passwd [选项] [用户名]`

**常用选项：**

- `-l`：锁定用户账户，使其无法登录。
- `-u`：解锁用户账户。
- `-d`：删除用户密码，使其可以无密码登录（极其危险，慎用）。
- `-e`：使用户密码立即过期，强制用户在下次登录时修改密码。

**实例：**

bash

```
# 当前用户修改自己的密码
passwd

# root 用户为 john 设置密码
sudo passwd john

# 锁定用户 john
sudo passwd -l john

# 强制 john 下次登录时改密码
sudo passwd -e john
```



#### 3. `usermod` - 修改用户属性

**功能：** 修改已存在用户的属性。

**常用语法：** `usermod [选项] 用户名`

**常用选项：**（与 `useradd` 类似）

- `-c, -d, -s, -u`：同 `useradd`。
- `-g`：修改用户的主组。
- `-G`：修改用户的附加组（**注意：这会覆盖原有的附加组**。要添加而不覆盖，需结合 `-a` 选项）。
- `-aG`：**（非常常用）** 将用户追加到一个或多个附加组中，不覆盖原有组。
- `-L`：锁定用户（同 `passwd -l`）。
- `-U`：解锁用户（同 `passwd -u`）。

**实例：**

bash

```
# 修改用户的注释信息
sudo usermod -c "John Smith" john

# 修改用户的家目录，并将旧目录内容移动到新目录
sudo usermod -d /new/home/john -m john

# 修改用户的登录Shell
sudo usermod -s /sbin/nologin john

# 【错误示范】这将使 john 的附加组只有 docker，会移出其他所有附加组
sudo usermod -G docker john

# 【正确示范】将 john 添加到 docker 组，同时保留他原有的其他附加组
sudo usermod -aG docker john

# 锁定账户
sudo usermod -L john
```



#### 4. `userdel` - 删除用户

**功能：** 删除用户账户。

**常用语法：** `userdel [选项] 用户名`

**常用选项：**

- `-r`：**同时删除用户的家目录和邮件池（`/var/spool/mail/用户名`）。**

**实例：**

bash

```
# 只删除用户，不删除家目录（会留下垃圾）
sudo userdel john

# 彻底删除用户及其家目录
sudo userdel -r john
```



#### 5. `id` - 查看用户信息

**功能：** 显示用户的 UID、GID 和所属的组。

**实例：**

bash

```
id          # 查看当前用户信息
id john     # 查看 john 用户的信息
```



输出示例：`uid=1001(john) gid=1001(john) groups=1001(john),27(sudo),999(docker)`

#### 6. `su` - 切换用户

**功能：** 切换当前用户身份。

**常用语法：** `su [选项] [用户名]`

**常用选项：**

- `-` 或 `-l` 或 `--login`：模拟一次完整的登录，会加载目标用户的环境变量。

**实例：**

bash

```
su john         # 切换到 john 用户（环境变量可能还是原用户的）
su - john       # 完全切换到 john 用户（推荐方式）

# 从普通用户切换到 root（需要输入 root 密码）
su - root
# 或者简写
su -
```



------

### 二、用户组管理

组信息存储在 `/etc/group` 文件中。

#### 1. `groupadd` - 创建新组

**功能：** 创建新的用户组。

**常用语法：** `groupadd [选项] 组名`

**常用选项：**

- `-g GID`：指定组的 GID。

**实例：**

bash

```
sudo groupadd developers
sudo groupadd -g 2000 admins
```



#### 2. `groupmod` - 修改组属性

**功能：** 修改已存在组的属性。

**常用语法：** `groupmod [选项] 组名`

**常用选项：**

- `-n 新组名`：修改组名。
- `-g 新GID`：修改组的 GID。

**实例：**

bash

```
sudo groupmod -n devs developers  # 将组名 developers 改为 devs
sudo groupmod -g 2001 devs        # 修改 devs 组的 GID 为 2001
```



#### 3. `groupdel` - 删除组

**功能：** 删除用户组。

**语法：** `groupdel 组名`

**注意：** 如果该组是某个用户的主组，则无法删除。必须先修改那些用户的主组。

**实例：**

bash

```
sudo groupdel devs
```



#### 4. `gpasswd` - 管理组成员

**功能：** 用于管理组的管理员和成员。

**常用语法：** `gpasswd [选项] 组名`

**常用选项：**

- `-a 用户名`：将用户添加到组。
- `-d 用户名`：将用户从组中移除。
- `-M 用户列表`：**设置组的成员列表**（用逗号分隔，会覆盖原有成员）。

**实例：**

bash

```
# 将 john 添加到 developers 组（效果同 usermod -aG）
sudo gpasswd -a john developers

# 将 alice 从 developers 组中移除
sudo gpasswd -d alice developers

# 设置 developers 组的成员只有 john 和 alice
sudo gpasswd -M john,alice developers
```



------

### 三、权限管理

Linux 中每个文件和目录都有三组权限：**所有者（Owner）**、**所属组（Group）** 和 **其他用户（Others）**。

#### 1. `ls -l` - 查看详细权限

**输出示例：**
`-rwxr-xr-- 1 owner group 1234 Jun 1 10:00 script.sh`

- **第一个字符：** 文件类型（`-` 普通文件，`d` 目录，`l` 链接等）。
- **接下来9个字符：** 权限位，3个一组。
  - **前3位：** 所有者权限（`rwx`）
  - **中3位：** 所属组权限（`r-x`）
  - **后3位：** 其他用户权限（`r--`）
- **权限符号：**
  - `r` = 读权限（4）
  - `w` = 写权限（2）
  - `x` = 执行权限（1）
  - `-` = 无相应权限

#### 2. `chmod` - 修改文件权限

**功能：** 改变文件或目录的访问权限。

**有两种设置方法：符号法和数字法。**

**A. 符号法（相对直观）**
**语法：** `chmod [ugoa][+-=][rwx] 文件/目录`

- **`u`**：所有者（user）
- **`g`**：所属组（group）
- **`o`**：其他用户（others）
- **`a`**：所有用户（all，相当于 ugo）
- **`+`**：添加权限
- **`-`**：移除权限
- **`=`**：设置精确权限

**实例：**

bash

```
chmod u+x script.sh          # 给所有者添加执行权限
chmod g-w file.txt           # 从所属组移除写权限
chmod o=r file.txt           # 设置其他用户只有读权限
chmod a+r file.txt           # 给所有用户添加读权限
chmod u=rwx,g=rx,o= script.sh # 所有者rwx，组rx，其他用户无权限
```



**B. 数字法（绝对设置，更常用）**
**语法：** `chmod ABC 文件/目录`

- `A` = 所有者权限的数字和（4+2+1）
- `B` = 所属组权限的数字和
- `C` = 其他用户权限的数字和

**权限计算：** r=4, w=2, x=1。将需要的权限相加。

- `7` = 4+2+1 (rwx)
- `6` = 4+2 (rw-)
- `5` = 4+1 (r-x)
- `4` = 4 (r--)
- `0` = 0 (---)

**实例：**

bash

```
chmod 755 script.sh  # rwxr-xr-x (所有者全权限，组和其他读执行)
chmod 644 file.txt   # rw-r--r-- (所有者读写，组和其他只读)
chmod 600 .ssh/id_rsa # rw------- (只有所有者可读写，非常安全)
chmod 777 /tmp/share # rwxrwxrwx (所有用户全权限，慎用！)
```



**递归修改目录权限：**

bash

```
chmod -R 755 /path/to/directory/ # 递归修改目录及其下所有内容
```



#### 3. `chown` - 修改文件所有者

**功能：** 改变文件或目录的所有者和/或所属组。

**常用语法：** `chown [选项] 新所有者:新所属组 文件/目录`

**常用选项：**

- `-R`：递归修改目录及其下所有内容。

**实例：**

bash

```
# 改变文件的所有者
sudo chown john file.txt

# 改变文件的所有者和所属组
sudo chown john:developers script.sh

# 只改变文件的所属组
sudo chown :www-data /var/www/html/

# 递归改变目录的所有权
sudo chown -R alice:alice /home/alice/project/
```



#### 4. 特殊权限：SUID, SGID, Sticky Bit

**A. SUID (Set User ID)**

- **作用：** 设置在**可执行文件**上，当其他用户执行此文件时，将**拥有文件所有者的权限**。
- **设置：** `chmod u+s file` 或数字法在最高位加 `4`（如 `4755`）。
- **示例：** `passwd` 命令（`/usr/bin/passwd`）就有 SUID 位，所以普通用户能修改自己的密码（写入 `/etc/shadow`）。

**B. SGID (Set Group ID)**

- **作用1（文件）：** 类似 SUID，但执行时获得的是**文件所属组的权限**。
- **作用2（目录）：** 设置在**目录**上，在该目录下创建的新文件，其**所属组会自动继承该目录的所属组**（而不是用户的主组）。
- **设置：** `chmod g+s dir` 或数字法在最高位加 `2`（如 `2775`）。

**C. Sticky Bit (粘滞位)**

- **作用：** 设置在**目录**上（如 `/tmp`），该目录下的文件**只有文件所有者、目录所有者或 root 才能删除/重命名**，即使用户对该目录有写权限。
- **设置：** `chmod o+t dir` 或数字法在最高位加 `1`（如 `1777`）。

**实例：**

bash

```
# 为命令添加 SUID
sudo chmod u+s /usr/local/bin/my_script

# 为共享目录设置 SGID，使新建文件继承目录的组
sudo chmod g+s /shared_folder

# 为公共目录设置粘滞位（如 /tmp）
sudo chmod o+t /public_upload
```



------

### 总结与实践建议

1. **最小权限原则：** 只授予完成工作所必需的最小权限。
2. **理解所有权：** 文件能否被删除，取决于其**所在目录的写权限**，而不是文件本身的权限。
3. **安全实践：**
   - 敏感文件（如 SSH 密钥）设置为 `600`。
   - 可执行脚本设置为 `755`。
   - 普通配置文件设置为 `644`。
   - 共享目录使用 `SGID` 来管理组权限。
   - 公共可写目录（如 `/tmp`）必须设置 `Sticky Bit`。
4. **勤用 `man`：** 遇到不熟悉的选项，使用 `man chmod`、`man useradd` 等查看官方手册。

这套命令和概念是 Linux 系统管理的基石，务必熟练掌握。